$(function () {
	lf_detailFrame();
});

function lf_detailFrame(){
	var val = opener.document.getElementById("detailNum").value;
	var category = val.split('_')[0];
	var num = val.split('_')[1];
	var detailList = $('.malware_detail_list');
	var detailInfo = "";
	var dataList
	
	console.log(val);
	
	detailList.find('> li').remove();
	
	switch(category){
		case 'malwareEvent' : 
		$("#eventLabel").html("안티 멀웨어");
		detailInfo = (
			"<li><dl><dt>스캔유형</dt><dd></dd></dl></li>"+
			"<li><dl><dt>감염 파일 처리</dt><dd></dd></dl></li>"+
			"<li><dl><dt>파일명</dt><dd></dd></dl></li>"+
			"<li><dl><dt>바이러스명</dt><dd></dd></dl></li>"+
			"<li><dl><dt>수집시간</dt><dd></dd></dl></li>"+
			"<li><dl><dt>수정시간</dt><dd></dd></dl></li>"+
			"<li><dl><dt>생성시간</dt><dd></dd></dl></li>"
			); break;
			
		case 'malwareHistory' : 
		detailInfo = (
			"<li><dl><dt>스캔유형</dt><dd></dd></dl></li>"+
			"<li><dl><dt>스캔 파일 수</dt><dd></dd></dl></li>"+
			"<li><dl><dt>스캔 디렉토리 수</dt><dd></dd></dl></li>"+
			"<li><dl><dt>감염 파일 수</dt><dd></dd></dl></li>"+
			"<li><dl><dt>검사 시간</dt><dd></dd></dl></li>"+
			"<li><dl><dt>매칭 대상 바이러스 수</dt><dd></dd></dl></li>"+
			"<li><dl><dt>수집시간</dt><dd></dd></dl></li>"+
			"<li><dl><dt>수정시간</dt><dd></dd></dl></li>"+
			"<li><dl><dt>생성시간</dt><dd></dd></dl></li>"
			); break;
		
		default : 
		detailInfo = (
			""
			); break;
	}
	detailList.append(detailInfo);

	lf_eventDetail(category, num);
}

function lf_eventDetail(category, num){
	var detailData = opener.document.getElementById("detailData").value;
	console.log(detailData);

	var rowData = JSON.parse(detailData);	
	
	$('#detail_info').text(rowData['dn'] + '(' + rowData['equip_ip'] + ') / ' + rowData['revisetime'] );
	$('#detail_info').prepend('<span>(<em>'+num+'</em>)</span> ');
	var dp = function(name) {
		if(name == 'type') {
			if(rowData['type'] == 1) return '예약 검사';
			else if(rowData['type'] == 2) return '수동 검사';
			else if(rowData['type'] == 3) return '실시간 검사';
		} else if(name == 'action') {
			var actionStr = '';
			if(rowData['action'] == 0) {
				actionStr = '없음';
			} else {
				if((rowData['action'] & 4) != 0) actionStr = actionStr + (actionStr==''? '격리' : ', 격리');
				if((rowData['action'] & 8) != 0) actionStr = actionStr + (actionStr==''? '복사' : ', 복사');
				if((rowData['action'] & 16) != 0) actionStr = actionStr + (actionStr==''? '삭제' : ', 삭제');
				if((rowData['action'] & 32) != 0) actionStr = actionStr + (actionStr==''? '실행 차단' : ', 실행 차단');					
			}
						
			return actionStr == ''? '없음' : actionStr;
		} else {
			return rowData[name];
		}
		return '';
	};
	
	var equip_ip = rowData['equip_ip'];
	if(!equip_ip) equip_ip = rowData['devIP'];
	
	$("#deviceNm1").val("(" + num + ") " + rowData['dn'] + "(" + equip_ip + ")");
	$("#deviceNm2").val("(" + num + ") " + rowData['dn'] + "(" + equip_ip + ")");
	$("#eventDtm1").val(rowData['revisetime']);
	$("#eventDtm2").val(rowData['revisetime']);
	
	
	var bodyList = $('ul.malware_detail_list > li > dl > dd');
	if(category == 'malwareEvent') {		
		lf_setData(bodyList[0], dp('type'));
		lf_setData(bodyList[1], dp('action'));
		lf_setData(bodyList[2], dp('filename'));
		lf_setData(bodyList[3], dp('virusname'));
		lf_setData(bodyList[4], dp('collecttime'));
		lf_setData(bodyList[5], dp('revisetime'));
		lf_setData(bodyList[6], dp('createtime'));
	} else if(category == 'malwareHistory') {
		lf_setData(bodyList[0], dp('type'));
		lf_setData(bodyList[1], dp('scanfilecount'));
		lf_setData(bodyList[2], dp('scandircount'));
		lf_setData(bodyList[3], dp('infectfilecount'));
		lf_setData(bodyList[4], dp('scantotaltime'));
		lf_setData(bodyList[5], dp('viruscount'));
		lf_setData(bodyList[6], dp('collecttime'));
		lf_setData(bodyList[7], dp('revisetime'));
		lf_setData(bodyList[8], dp('createtime'));
	}
}



function lf_setData(thiz, data) {
	$(thiz).text(data);
	$(thiz).attr('title', data);
}


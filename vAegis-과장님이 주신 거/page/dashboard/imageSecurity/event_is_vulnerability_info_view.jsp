<%@page language="java" contentType="text/html; charset=utf-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html lang="ko">

<head>
	<title>컨테이너 이미지 스캔 현황 상세 - Aegis</title>
	<meta charset="UTF-8" http-equiv="Content-Type">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=3.0">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no" />

	<!-- TODO: search engine info -->
	<meta name="robots" content="Aegis" />
	<meta name="keywords" content="Aegis" />
	<meta name="title" content="Aegis" />
	<meta name="description" content="Aegis" />
	
	<!-- TODO: social url link image -->
	<meta property="og:url" content="">
	<meta property="og:title" content="Aegis">
	<meta property="og:type" content="website">
	<meta property="og:image" content="Aegis.png">
	<meta property="og:description" content="Aegis 홈페이지입니다.">
	
	<!-- TODO: favicon -->
	<link rel="icon" href="./assets/images/favicon.png" type="favicon.png" />
	
	<!-- TODO: import -->
	<%@ include file="/page/layout/common.jsp"%>
	
	<script src="./js/common/page_common.js?v=${version}"></script>
 	<script src="./js/service/dashboards/imageSecurity/dashboardScanStatus.js?v=${version}"></script>
 	<script src="./js/service/dashboards/imageSecurity/eventVulnerabilityInfo.js?v=${version}"></script>
 	<script src="./js/service/dashboards/imageSecurity/eventDashboardInfo.js?v=${version}"></script> 	

	<!-- DataTables Type -->
	<script type="text/javascript">
		$(document).ready(function() {
			/* Formatting function for row details - modify as you need */
			$('#event_vulnerability_detail_result_table').DataTable({	
				"autoWidth" : false,
				"paging" : true,
				"pagingType" : "full_numbers",
				"order":[],
				"info" : false,
				"language": false,
				"dom": 'rt<"bottom"ip><"clear">',
				"pageLength" : 10,
				"initComplete": function(settings, json) {
		            $('[data-toggle="tooltip"]').tooltip();
				},
				"columns" :[
					{"data":"Registry"},
					{"data":"Digest"},
					{"data":"Image Tag"},
					{"data":"Identifier"},
					{"data":"Severity"},
					{"data":"CVSS Score"},
					{"data":"Description"},
					{"data":"Url"},
					{"data":"Created Date"},
					{"data":"Uuid"}, // index 9 : row Uuid
				],
				"columnDefs": [
		            {
		                targets: [ 7 ], // 7번째 열을 대상으로 설정(Url)
		                render: function ( data, type, row ) {
		                    if(data){
		                    	// data를 하이퍼텍스트 링크로 변경
			                    return '<a style="color: #bbb; text-decoration: underline;" href="'+data+'" target="_blank">'+data+'</a>';
		                    }
		                    else{
		                    	return '-';
		                    }
		                	
		                }
		            },
		            {
						"targets": "_all", 
						"createdCell": function(td, cellData, rowData, row, col) {
							$(td).attr('title', cellData); // title 속성에 데이터 추가
							// 스타일 속성 설정
							$(td).css({
								'white-space': 'nowrap',
								'overflow': 'hidden',
								'text-overflow': 'ellipsis'
							}); 
						}
					}
		        ]
			});
			
			/* Formatting function for row details - modify as you need */
			$('#event_vulnerability_package_result_table').DataTable({	
				"autoWidth" : false,
				"paging" : true,
				"pagingType" : "full_numbers",
				"info" : false,							
				"dom": 'rt<"bottom"ip><"clear">',
				"pageLength" : 10,
				"columns" :[
					{"data":"Package Name"},
					{"data":"Package Path"},
					{"data":"Package Version"},
					{"data":"Fix Version"},
					{"data":"CVSS"},
					{"data":"CPE"},
				],
				"columnDefs": [
					{
						"targets": "_all", 
						"createdCell": function(td, cellData, rowData, row, col) {
							$(td).attr('title', cellData); // title 속성에 데이터 추가
							// 스타일 속성 설정
							$(td).css({
								'white-space': 'nowrap',
								'overflow': 'hidden',
								'text-overflow': 'ellipsis'
							}); 
						}
					}
				],
			});
			$('.sel_box select').niceSelect();
		});
	</script>
</head>

<input type="hidden" id="detail_info_paging" value="">
<body class="win_popup event">
	<section style="background-color:#161b22;">
		<h4 id="cspInfoTitle">Vulnerabilities Detail</h4>
		<div class="popup_view_cont">
			<div id="tabMgmt" class="tab_container">
				<div class="tabMgmt_1 tab_cont open">
					<div class="top vul_top">
						<div class="is_info">
							<div class="is_info_box">
								<div style="color:#b32d33;" class="critical" onclick="cntClick(this.className)">
									<p id="criticalCnt">0</p>
									<p>Critical</p>
								</div>
								<div style="color:#e14a42;" class="high" onclick="cntClick(this.className)">
									<p id="highCnt">0</p>
									<p>High</p>
								</div>
								<div style="color:#f4bf72;" class="medium" onclick="cntClick(this.className)">
									<p id="mediumCnt">0</p>
									<p>Medium</p>
								</div>
								<div style="color:#ebcb17;" class="low" onclick="cntClick(this.className)">
									<p id="lowCnt">0</p>
									<p>Low</p>
								</div>
								<div style="color: #4090d3;" class="info" onclick="cntClick(this.className)">
									<p id="infoCnt">0</p>
									<p>Info</p>
								</div>
								<div style="color:grey;" class="unknown" onclick="cntClick(this.className)">
									<p id="unknownCnt">0</p>
									<p>Unknown</p>
								</div>
							</div>
							
						</div>
					</div>
					<div class="detail">
						<!-- TODO : 테이블 적용 후 event_cont 스타일 확인. 이상없는 경우 해당 class 등록 -->
						<div class="event_cont" style="
						    display: flex;
						    flex-direction: column;
							">
							<div class="tbl vul_detail_tbl">
								<div class="is_info_search_box">
									<div class="ipt_box" style="width:400px;">
										<input class="" type="text" placeholder="Image Tag 혹은 Identifier,Description 키워드를 입력해 주세요" id="searchKeyword" name="vulSearchKeyword">
									</div>
									<a id="vulSearchBtn" href="#" class="btn serch" onclick="vulSearchBtnClick()">검색</a>
								</div>
							
								<table id="event_vulnerability_detail_result_table" class="">
									<colgroup>
										<col width="8%">
										<col width="10%">
										<col width="8%">
										<col width="10%">
										<col width="8%">
										<col width="8%">
										<col width="auto">
										<col width="auto">
										<col width="10%">
										<col width="0px">
									</colgroup>
									<thead>
										<tr>
											<th>Registry</th>
											<th>Digest</th>
											<th>Image Tag</th>
											<th>Identifier</th>
											<th>Severity</th>
											<th>CVSS Score</th>
											<th>Description</th> 
											<th>Url</th>
											<th>Created Date</th>
											<th style="display: none;">Uuid</th> <!-- Vulnerabiliy 분석 결과 Uuid 값 숨김(포커스에 활용) -->
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>		
							
										
							<div class="tbl vul_detail_tbl">
								<div class="is_info_search_box">
									<div class="ipt_box">
										<input class="" type="text" placeholder="Package Name 키워드를 입력해 주세요" id="searchPackageKeyword" name="vulPackageSearchKeyword">
									</div>
									<a id="vulPackageSearchBtn" href="#" class="btn serch" onclick="vulPackageSearchBtnClick()">>검색</a>
								</div>
								
								<table id="event_vulnerability_package_result_table" class="">
									<colgroup>
										<col width="10%">
										<col width="auto">
										<col width="10%">
										<col width="10%">
										<col width="auto">
										<col width="auto">
									</colgroup>
									<thead>
										<tr>
											<th>Package Name</th>
											<th>Package-related Path</th>
											<th>Package Version</th>
											<th>Fix Version</th> 
											<th>CVSS</th>
											<th>CPE</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</body>
</html>